{"ast":null,"code":"import _objectSpread from\"C:/Users/frank/OneDrive/Desktop/mini-library/library-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// frontend/components/BookList.js\nimport React,{useState,useEffect}from\"react\";import{Link}from\"react-router-dom\";import axios from\"axios\";import BookCard from\"./BookCard\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BookList=()=>{const[books,setBooks]=useState([]);const[loading,setLoading]=useState(true);const[searchTerm,setSearchTerm]=useState(\"\");const[selectedCategory,setSelectedCategory]=useState(\"All\");const[userIssuedBookId,setUserIssuedBookId]=useState(null);const categories=[\"All\",\"F1 Racing\",\"Motorsports\",\"Vintage Cars\",\"Motorbikes\",\"Automotive Engineering\"];const fetchBooksAndUser=async()=>{try{const token=localStorage.getItem(\"token\");const headers=token?{Authorization:\"Bearer \".concat(token)}:{};// 1️⃣ Fetch books\nconst booksRes=await axios.get(\"/api/books\",{params:{search:searchTerm||undefined,category:selectedCategory===\"All\"?undefined:selectedCategory},headers});let booksData=Array.isArray(booksRes.data)?booksRes.data:Array.isArray(booksRes.data.books)?booksRes.data.books:[];booksData=booksData.map(book=>_objectSpread(_objectSpread({},book),{},{avgRating:Number(book===null||book===void 0?void 0:book.avgRating)||0}));setBooks(booksData);// 2️⃣ Fetch current user’s issued book (if logged in)\nif(token){var _userRes$data,_userRes$data$issuedB;const userRes=await axios.get(\"/api/auth/me\",{headers});if(((_userRes$data=userRes.data)===null||_userRes$data===void 0?void 0:(_userRes$data$issuedB=_userRes$data.issuedBooks)===null||_userRes$data$issuedB===void 0?void 0:_userRes$data$issuedB.length)>0){setUserIssuedBookId(userRes.data.issuedBooks[0]);// Only one issued book allowed\n}else{setUserIssuedBookId(null);}}}catch(err){console.error(err);setBooks([]);}finally{setLoading(false);}};// Debounce search/filter\nuseEffect(()=>{setLoading(true);const delayDebounce=setTimeout(()=>{fetchBooksAndUser();},500);return()=>clearTimeout(delayDebounce);// eslint-disable-next-line\n},[searchTerm,selectedCategory]);return/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-800 mb-6\",children:\"Automobile & Racing Books\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:items-center gap-3 mb-6\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search books...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"flex-1 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedCategory,onChange:e=>setSelectedCategory(e.target.value),className:\"px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\",children:categories.map(cat=>/*#__PURE__*/_jsx(\"option\",{value:cat,children:cat},cat))}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchBooksAndUser,className:\"px-6 py-2 bg-indigo-600 text-white rounded-md shadow hover:bg-indigo-700 transition\",children:\"Search\"})]}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-600\"})}):books.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xl text-gray-600\",children:\"No books found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mt-2\",children:\"Try adjusting your search or filter\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8\",children:books.map(book=>{const isUserIssuedBook=userIssuedBookId===book._id;const isUnavailable=book.isIssued&&!isUserIssuedBook;// Issued by someone else\nreturn/*#__PURE__*/_jsx(Link,{to:\"/books/\".concat(book._id),className:\"hover:scale-105 transition transform\",children:/*#__PURE__*/_jsx(BookCard,{book:_objectSpread(_objectSpread({},book),{},{isUnavailable,isUserIssuedBook})})},book._id);})})]});};export default BookList;","map":{"version":3,"names":["React","useState","useEffect","Link","axios","BookCard","jsx","_jsx","jsxs","_jsxs","BookList","books","setBooks","loading","setLoading","searchTerm","setSearchTerm","selectedCategory","setSelectedCategory","userIssuedBookId","setUserIssuedBookId","categories","fetchBooksAndUser","token","localStorage","getItem","headers","Authorization","concat","booksRes","get","params","search","undefined","category","booksData","Array","isArray","data","map","book","_objectSpread","avgRating","Number","_userRes$data","_userRes$data$issuedB","userRes","issuedBooks","length","err","console","error","delayDebounce","setTimeout","clearTimeout","className","children","type","placeholder","value","onChange","e","target","cat","onClick","isUserIssuedBook","_id","isUnavailable","isIssued","to"],"sources":["C:/Users/frank/OneDrive/Desktop/mini-library/library-frontend/src/components/books/BookList.js"],"sourcesContent":[" // frontend/components/BookList.js\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport BookCard from \"./BookCard\";\r\n\r\nconst BookList = () => {\r\n  const [books, setBooks] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [selectedCategory, setSelectedCategory] = useState(\"All\");\r\n  const [userIssuedBookId, setUserIssuedBookId] = useState(null);\r\n\r\n  const categories = [\r\n    \"All\",\r\n    \"F1 Racing\",\r\n    \"Motorsports\",\r\n    \"Vintage Cars\",\r\n    \"Motorbikes\",\r\n    \"Automotive Engineering\",\r\n  ];\r\n\r\n  const fetchBooksAndUser = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const headers = token ? { Authorization: `Bearer ${token}` } : {};\r\n\r\n      // 1️⃣ Fetch books\r\n      const booksRes = await axios.get(\"/api/books\", {\r\n        params: {\r\n          search: searchTerm || undefined,\r\n          category: selectedCategory === \"All\" ? undefined : selectedCategory,\r\n        },\r\n        headers,\r\n      });\r\n\r\n      let booksData = Array.isArray(booksRes.data)\r\n        ? booksRes.data\r\n        : Array.isArray(booksRes.data.books)\r\n        ? booksRes.data.books\r\n        : [];\r\n\r\n      booksData = booksData.map((book) => ({\r\n        ...book,\r\n        avgRating: Number(book?.avgRating) || 0,\r\n      }));\r\n\r\n      setBooks(booksData);\r\n\r\n      // 2️⃣ Fetch current user’s issued book (if logged in)\r\n      if (token) {\r\n        const userRes = await axios.get(\"/api/auth/me\", { headers });\r\n        if (userRes.data?.issuedBooks?.length > 0) {\r\n          setUserIssuedBookId(userRes.data.issuedBooks[0]); // Only one issued book allowed\r\n        } else {\r\n          setUserIssuedBookId(null);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      setBooks([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Debounce search/filter\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    const delayDebounce = setTimeout(() => {\r\n      fetchBooksAndUser();\r\n    }, 500);\r\n\r\n    return () => clearTimeout(delayDebounce);\r\n    // eslint-disable-next-line\r\n  }, [searchTerm, selectedCategory]);\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 py-8\">\r\n      {/* Page Title */}\r\n      <h1 className=\"text-3xl font-bold text-gray-800 mb-6\">\r\n        Automobile & Racing Books\r\n      </h1>\r\n\r\n      {/* Search + Category + Button */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center gap-3 mb-6\">\r\n        {/* Search Input */}\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search books...\"\r\n          value={searchTerm}\r\n          onChange={(e) => setSearchTerm(e.target.value)}\r\n          className=\"flex-1 px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n        />\r\n\r\n        {/* Category Dropdown */}\r\n        <select\r\n          value={selectedCategory}\r\n          onChange={(e) => setSelectedCategory(e.target.value)}\r\n          className=\"px-4 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n        >\r\n          {categories.map((cat) => (\r\n            <option key={cat} value={cat}>\r\n              {cat}\r\n            </option>\r\n          ))}\r\n        </select>\r\n\r\n        {/* Optional Search Button */}\r\n        <button\r\n          onClick={fetchBooksAndUser}\r\n          className=\"px-6 py-2 bg-indigo-600 text-white rounded-md shadow hover:bg-indigo-700 transition\"\r\n        >\r\n          Search\r\n        </button>\r\n      </div>\r\n\r\n      {/* Book List */}\r\n      {loading ? (\r\n        <div className=\"flex justify-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-600\"></div>\r\n        </div>\r\n      ) : books.length === 0 ? (\r\n        <div className=\"text-center py-12\">\r\n          <p className=\"text-xl text-gray-600\">No books found</p>\r\n          <p className=\"text-gray-500 mt-2\">\r\n            Try adjusting your search or filter\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8\">\r\n          {books.map((book) => {\r\n            const isUserIssuedBook = userIssuedBookId === book._id;\r\n            const isUnavailable =\r\n              book.isIssued && !isUserIssuedBook; // Issued by someone else\r\n\r\n            return (\r\n              <Link\r\n                to={`/books/${book._id}`}\r\n                key={book._id}\r\n                className=\"hover:scale-105 transition transform\"\r\n              >\r\n                <BookCard\r\n                  book={{\r\n                    ...book,\r\n                    isUnavailable,\r\n                    isUserIssuedBook,\r\n                  }}\r\n                />\r\n              </Link>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BookList;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}